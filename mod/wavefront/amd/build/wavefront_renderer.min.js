define("mod_wavefront/wavefront_renderer",["exports","mod_wavefront/WebGL","mod_wavefront/three","mod_wavefront/MTLLoader","mod_wavefront/OBJLoader","mod_wavefront/OrbitControls","jquery"],(function(_exports,_WebGL,THREE,_MTLLoader,_OBJLoader,_OrbitControls,_jquery){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Encapsules the behavior for creating a Wavefront 3D model in Moodle.
   *
   * Manages the UI while operations are occuring, including rendering and manipulating the model.
   *
   * @module     mod_wavefront/model_renderer
   * @class      model_renderer
   * @package    mod_wavefront
   * @copyright  2022 Ian Wild
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since      3.9
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_WebGL=_interopRequireDefault(_WebGL),THREE=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(THREE),_jquery=_interopRequireDefault(_jquery);var cameras=[],controls_array=[],scenes=[],renderers=[],containers=[],stage_widths=[],stage_heights=[],scene_backcolours=[],ambients=[],keyLights=[],fillLights=[],backLights=[];window.innerWidth,window.innerHeight;const animate=()=>{renderers.forEach((function(renderer,i){renderer.render(scenes[i],cameras[i]),controls_array[i].update()})),requestAnimationFrame(animate)};_exports.init=stage=>{if(!_WebGL.default.isWebGLAvailable()){const warning=_WebGL.default.getWebGLErrorMessage();return document.getElementById("container").appendChild(warning),!0}console.log(stage);var container=document.getElementById(stage);console.log(container),containers.push(container);var stage_width=(0,_jquery.default)(container).attr("data-stagewidth");console.log("stage width: "+stage_width),stage_widths.push(stage_width);var stage_height=(0,_jquery.default)(container).attr("data-stageheight");console.log("stage height: "+stage_height),stage_heights.push(stage_height);var backcol=(0,_jquery.default)(container).attr("data-backcol");console.log("background color: "+backcol),scene_backcolours.push(backcol);var cameraangle=(0,_jquery.default)(container).attr("data-cameraangle");console.log("camera angle: "+cameraangle);var cameranear=(0,_jquery.default)(container).attr("data-cameranear");console.log("camera near: "+cameranear);var camerafar=(0,_jquery.default)(container).attr("data-camerafar");console.log("camera far: "+cameranear);var camerax=(0,_jquery.default)(container).attr("data-camerax");console.log("camera x: "+camerax);var cameray=(0,_jquery.default)(container).attr("data-cameray");console.log("camera y: "+cameray);var cameraz=(0,_jquery.default)(container).attr("data-cameraz");console.log("camera z: "+cameraz);var controlx=(0,_jquery.default)(container).attr("data-controlx");console.log("control x: "+controlx);var controly=(0,_jquery.default)(container).attr("data-controly");console.log("control y: "+controly);var controlz=(0,_jquery.default)(container).attr("data-controlz");console.log("control z: "+controlz);var mtl=(0,_jquery.default)(container).attr("data-mtl");console.log(mtl);var mtl_file=decodeURIComponent(mtl);console.log(mtl_file);var obj=(0,_jquery.default)(container).attr("data-obj");console.log(obj);var obj_file=decodeURIComponent(obj);console.log(obj_file),(new _MTLLoader.MTLLoader).load(mtl_file,(materials=>{materials.preload();var objLoader=new _OBJLoader.OBJLoader;objLoader.setMaterials(materials),objLoader.load(obj_file,(function(object){var scene=new THREE.Scene;scenes.push(scene);var SCREEN_WIDTH=stage_width,SCREEN_HEIGHT=stage_height,VIEW_ANGLE=Number(cameraangle),ASPECT=SCREEN_WIDTH/SCREEN_HEIGHT,NEAR=Number(cameranear),FAR=Number(camerafar),camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR);cameras.push(camera),scene.add(camera),camera.position.set(Number(camerax),Number(cameray),Number(cameraz));var ambient=new THREE.AmbientLight(16777215,1);ambients.push(ambient),scene.add(ambient);var keyLight=new THREE.DirectionalLight(new THREE.Color("hsl(30, 100%, 75%)"),1);keyLights.push(keyLight),keyLight.position.set(-100,0,100);var fillLight=new THREE.DirectionalLight(new THREE.Color("hsl(240, 100%, 75%)"),.75);fillLights.push(fillLight),fillLight.position.set(100,0,100);var backLight=new THREE.DirectionalLight(16777215,1);backLights.push(backLight),backLight.position.set(100,0,-100).normalize(),scene.add(keyLight),scene.add(fillLight),scene.add(backLight),scene.add(object);var iCol=Number("0x"+backcol);scene.background=new THREE.Color(iCol);var renderer=new THREE.WebGLRenderer;renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(stage_width,stage_height),renderer.setClearColor(new THREE.Color("hsl(0, 0%, 10%)")),renderers.push(renderer),container.appendChild(renderer.domElement);var controls=new _OrbitControls.OrbitControls(camera,renderer.domElement);controls.enableDamping=!0,controls.dampingFactor=.25,controls.target.set(Number(controlx),Number(controly),Number(controlz)),controls_array.push(controls),window.addEventListener("keydown",(function(e){e.stopPropagation(),"KeyL"===e.code&&(lighting=!lighting,lighting?(ambient.intensity=.25,scene.add(keyLight),scene.add(fillLight),scene.add(backLight)):(ambient.intensity=1,scene.remove(keyLight),scene.remove(fillLight),scene.remove(backLight)))}),!1),(0,_jquery.default)(container).next().remove(),animate()}))}))}}));

//# sourceMappingURL=wavefront_renderer.min.js.map