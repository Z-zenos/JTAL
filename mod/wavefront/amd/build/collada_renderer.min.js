define("mod_wavefront/collada_renderer",["exports","mod_wavefront/WebGL","mod_wavefront/three","mod_wavefront/ColladaLoader","mod_wavefront/OrbitControls","jquery"],(function(_exports,_WebGL,THREE,_ColladaLoader,_OrbitControls,_jquery){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Encapsules the behavior for creating a Collada 3D model in Moodle.
   *
   * Manages the UI while operations are occuring, including rendering and manipulating the model.
   *
   * @module     mod_wavefront/collada_renderer
   * @class      collada_renderer
   * @package    mod_wavefront
   * @copyright  2022 Ian Wild
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since      3.9
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_WebGL=_interopRequireDefault(_WebGL),THREE=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(THREE),_jquery=_interopRequireDefault(_jquery);var cameras=[],controls_array=[],scenes=[],renderers=[],containers=[],stage_widths=[],stage_heights=[],scene_backcolours=[],ambients=[],pointlights=[],clocks=[],mixers=[];const animate=()=>{renderers.forEach((function(renderer,i){if(void 0!==mixers[i]){var delta=clocks[i].getDelta();mixers[i].update(delta),renderer.render(scenes[i],cameras[i]),controls_array[i].update()}})),requestAnimationFrame(animate)};_exports.init=stage=>{if(!_WebGL.default.isWebGLAvailable()){const warning=_WebGL.default.getWebGLErrorMessage();return document.getElementById("container").appendChild(warning),!0}console.log(stage);var container=document.getElementById(stage);console.log(container),containers.push(container);var stage_width=(0,_jquery.default)(container).attr("data-stagewidth");console.log("stage width: "+stage_width),stage_widths.push(stage_width);var stage_height=(0,_jquery.default)(container).attr("data-stageheight");console.log("stage height: "+stage_height),stage_heights.push(stage_height);var backcol=(0,_jquery.default)(container).attr("data-backcol");console.log("background  color: "+backcol),scene_backcolours.push(backcol);var cameraangle=(0,_jquery.default)(container).attr("data-cameraangle");console.log("camera angle: "+cameraangle);var cameranear=(0,_jquery.default)(container).attr("data-cameranear");console.log("camera near: "+cameranear);var camerafar=(0,_jquery.default)(container).attr("data-camerafar");console.log("camera far: "+camerafar);var camerax=(0,_jquery.default)(container).attr("data-camerax");console.log("camera x: "+camerax);var cameray=(0,_jquery.default)(container).attr("data-cameray");console.log("camera y: "+cameray);var cameraz=(0,_jquery.default)(container).attr("data-cameraz");console.log("camera z: "+cameraz);var controlx=(0,_jquery.default)(container).attr("data-controlx");console.log("control x: "+controlx);var controly=(0,_jquery.default)(container).attr("data-controly");console.log("control y: "+controly);var controlz=(0,_jquery.default)(container).attr("data-controlz");console.log("control z: "+controlz);var baseurl=(0,_jquery.default)(container).attr("data-baseurl"),base_url=decodeURIComponent(baseurl);console.log(base_url);var dae=(0,_jquery.default)(container).attr("data-dae"),dae_file=decodeURIComponent(dae);console.log(dae_file),(new _ColladaLoader.ColladaLoader).load(dae_file,(collada=>{var animations=collada.animations,avatar=collada.scene;avatar.traverse((function(node){node.isSkinnedMesh&&(node.frustumCulled=!1)}));var scene=new THREE.Scene;scenes.push(scene);var SCREEN_WIDTH=stage_width,SCREEN_HEIGHT=stage_height,VIEW_ANGLE=Number(cameraangle),ASPECT=SCREEN_WIDTH/SCREEN_HEIGHT,NEAR=Number(cameranear),FAR=Number(camerafar),camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR);cameras.push(camera),scene.add(camera),camera.position.set(Number(camerax),Number(cameray),Number(cameraz)),clock=new THREE.Clock,clocks.push(clock),mixer=new THREE.AnimationMixer(avatar),mixers.push(mixer);mixer.clipAction(animations[0]).play();scene.add(avatar);var iCol=Number("0x"+backcol);scene.background=new THREE.Color(iCol);var ambientLight=new THREE.AmbientLight(16777215,.2);ambients.push[ambientLight],scene.add(ambientLight);var pointLight=new THREE.PointLight(16777215,.8);pointlights.push[pointLight],scene.add(camera),camera.add(pointLight);var renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(stage_width,stage_height),renderer.setClearColor(new THREE.Color("hsl(0, 0%, 10%)")),renderers.push(renderer),container.appendChild(renderer.domElement);var controls=new _OrbitControls.OrbitControls(camera,renderer.domElement);controls.enableDamping=!0,controls.dampingFactor=.25,controls.target.set(Number(controlx),Number(controly),Number(controlz)),controls_array.push(controls),(0,_jquery.default)(container).next().remove(),animate()}))}}));

//# sourceMappingURL=collada_renderer.min.js.map