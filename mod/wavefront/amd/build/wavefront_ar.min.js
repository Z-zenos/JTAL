define("mod_wavefront/wavefront_ar",["exports","mod_wavefront/three","mod_wavefront/MTLLoader","mod_wavefront/OBJLoader","mod_wavefront/ARButton","jquery"],(function(_exports,THREE,_MTLLoader,_OBJLoader,_ARButton,_jquery){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}
/**
   * Encapsules the behavior for creating a Wavefront 3D model in Moodle.
   *
   * Manages the UI while operations are occuring, including rendering and manipulating the model.
   *
   * @module     mod_wavefront/wavefront_ar
   * @class      wavefront_ar
   * @package    mod_wavefront
   * @copyright  2022 Ian Wild
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @since      3.9
   */
let camera,scene,renderer,controller,reticle,object,objectscale;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,THREE=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(THREE),_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};let hitTestSource=null,hitTestSourceRequested=!1;function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function render(timestamp,frame){if(frame){const referenceSpace=renderer.xr.getReferenceSpace(),session=renderer.xr.getSession();if(!1===hitTestSourceRequested&&(session.requestReferenceSpace("viewer").then((function(referenceSpace){session.requestHitTestSource({space:referenceSpace}).then((function(source){hitTestSource=source}))})),session.addEventListener("end",(function(){hitTestSourceRequested=!1,hitTestSource=null})),hitTestSourceRequested=!0),hitTestSource){const hitTestResults=frame.getHitTestResults(hitTestSource);if(hitTestResults.length){const hit=hitTestResults[0];reticle.visible=!0,reticle.matrix.fromArray(hit.getPose(referenceSpace).transform.matrix)}else reticle.visible=!1}}renderer.render(scene,camera)}_exports.init=(stage,scale)=>{var container=document.getElementById(stage);console.log(container),objectscale=scale;var mtl=(0,_jquery.default)(container).attr("data-mtl");console.log(mtl);var mtl_file=decodeURIComponent(mtl);console.log(mtl_file);var obj=(0,_jquery.default)(container).attr("data-obj");console.log(obj);var obj_file=decodeURIComponent(obj);console.log(obj_file);var cameraangle=(0,_jquery.default)(container).attr("data-cameraangle");console.log(cameraangle);var cameranear=(0,_jquery.default)(container).attr("data-cameranear");console.log(cameranear);var camerafar=(0,_jquery.default)(container).attr("data-camerafar");console.log(camerafar);var camerax=(0,_jquery.default)(container).attr("data-camerax");console.log(camerax);var cameray=(0,_jquery.default)(container).attr("data-cameray");console.log(cameray);var cameraz=(0,_jquery.default)(container).attr("data-cameraz");console.log(cameraz),scene=new THREE.Scene;var VIEW_ANGLE=Number(cameraangle),ASPECT=window.innerWidth/window.innerHeight,NEAR=Number(cameranear),FAR=Number(camerafar);camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR),camera.position.set(Number(camerax),Number(cameray),Number(cameraz));var keyLight=new THREE.DirectionalLight(new THREE.Color("hsl(30, 100%, 75%)"),1);keyLight.position.set(-100,0,100);var fillLight=new THREE.DirectionalLight(new THREE.Color("hsl(240, 100%, 75%)"),.75);fillLight.position.set(100,0,100);var backLight=new THREE.DirectionalLight(16777215,1);function onSelect(){reticle.visible&&(new _MTLLoader.MTLLoader).load(mtl_file,(materials=>{materials.preload();var objLoader=new _OBJLoader.OBJLoader;objLoader.setMaterials(materials),objLoader.load(obj_file,(function(obj){object=obj,reticle.matrix.decompose(object.position,object.quaternion,object.scale),object.scale.set(objectscale,objectscale,objectscale),scene.add(object),controller.removeEventListener("select",onSelect),scene.remove(reticle)}))}))}backLight.position.set(100,0,-100).normalize(),scene.add(keyLight),scene.add(fillLight),scene.add(backLight),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.xr.enabled=!0,renderer.xr.setReferenceSpaceType("local"),container.appendChild(renderer.domElement),renderer.xr.addEventListener("sessionend",(function(event){scene.remove(object),scene.add(reticle),reticle.visible=!1,controller.addEventListener("select",onSelect)})),document.body.appendChild(_ARButton.ARButton.createButton(renderer,{requiredFeatures:["hit-test"]})),controller=renderer.xr.getController(0),controller.addEventListener("select",onSelect),scene.add(controller),reticle=new THREE.Mesh(new THREE.RingGeometry(.15,.2,32).rotateX(-Math.PI/2),new THREE.MeshBasicMaterial),reticle.matrixAutoUpdate=!1,reticle.visible=!1,scene.add(reticle),window.addEventListener("resize",onWindowResize),renderer.setAnimationLoop(render)}}));

//# sourceMappingURL=wavefront_ar.min.js.map